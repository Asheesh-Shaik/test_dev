name: CI/CD Pipeline

on:
  push:
    branches:
      - master  # Adjust this if you are using a different branch

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: SSH to Azure VM and deploy
        uses: appleboy/ssh-action@v0.1.4
        with:
          host: 20.205.26.179
          username: test-dev # e.g., azureuser
          password: ${{ secrets.AZURE_PASSWORD }}  # Store your password in secrets
          script: |
            # Change to the application directory or create it if it doesn't exist
            if [ ! -d "my-streamlit-app" ]; then
              git clone <your-github-repo-url> my-streamlit-app
            fi
            cd my-streamlit-app

            # Pull the latest changes from the repository
            git pull origin master  # Adjust branch name if necessary

            # Build the Docker image
            docker build -t my-streamlit-app .

            # Stop and remove the existing container if it's running
            docker stop my-streamlit-app || true
            docker rm my-streamlit-app || true

            # Run the new container
            docker run -d -p 8501:8501 my-streamlit-app
